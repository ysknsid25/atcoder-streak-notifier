name: Notify Solve Streak

on:
  push:
    paths:
      - '**/*'  # すべてのファイルが対象

jobs:
  notify-solve-streak:
    runs-on: ubuntu-latest

    steps:
    - name: Check out the repository
      uses: actions/checkout@v4
      with:
        fetch-depth: 0
  
    - name: Has diff?
      if: github.event.before == '0000000000000000000000000000000000000000'
      run: |
        echo "This is the first commit, skipping diff."
        exit 0

    - name: Get changed files
      run: |
        files=$(git diff --name-only --diff-filter=A ${{ github.event.before }} ${{ github.sha }}  | grep -E '^[0-9]+-[A-G]')
        if [ -n "$files" ]; then
          echo "Found file(s): $files"
          curl -H "Content-Type: application/json" -d '{"username": "test", "content": "解いたのはこのファイルたち\n $files"}' "https://discord.com/api/webhooks/1298288337227874417/bDZyqaxUWQeKfTpkdsnEygE7xIHomc4fg3W0LU7xHTXiArojiIebzxa0IJKXksWTUqOK"
        else
          echo "No matching files found."
          exit 0
        fi    